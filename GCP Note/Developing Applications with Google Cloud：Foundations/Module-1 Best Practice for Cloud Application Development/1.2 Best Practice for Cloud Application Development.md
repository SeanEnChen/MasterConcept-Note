# 1.2 Best Practice for Cloud Application Development

- **快取 (Caching):**
    - **應用程式資料快取:** 快取常用或計算成本高的資料，減少延遲並提升效能。應用程式應先檢查快取，若未命中或過期才從後端資料源獲取並更新快取。Memorystore (Redis 或 Memcached) 是 GCP 的全託管記憶體快取服務。
    - **內容傳遞網路 (CDN):** 使用 Cloud CDN 快取網站內容，利用 Google 全球邊緣網路就近服務使用者，加速網站和應用程式。Cloud CDN 可服務來自 Cloud Storage、Cloud Run 或 Compute Engine 的靜態內容。
- **API 閘道 (API Gateway):**
    - **Apigee:** 使用 API 閘道 (如 Apigee) 作為後端服務 API 的門面，提供安全、速率限制、配額、分析等功能。對於無法重構的舊有應用程式，可透過 API 閘道提供現代化的 API 介面，方便消費者應用程式調用。
- **身份管理 (Identity Management):**
    - **委派身份驗證:** 委派使用者身份驗證給 Google 或其他外部供應商 (如 Facebook、GitHub)，簡化使用者管理。Identity Platform 提供可自訂的身份驗證服務，支援多種驗證方式 (外部供應商、Email/密碼、SAML、OpenID Connect、多因素驗證)。Firebase Authentication with Identity Platform 提供後端服務、SDK 和 UI 庫，簡化使用者身份驗證流程。
    - **聯邦身份管理:** 使用聯邦身份管理，無需自行實作、保護和擴展使用者身份驗證解決方案。
- **日誌管理 (Logging):**
    - **日誌視為事件流:** 將日誌視為持續的事件流，而非管理日誌檔案。寫入 stdout 等事件流，讓基礎架構收集事件以供後續分析和儲存。
    - **Google Cloud Observability:** 利用 Google Cloud Observability 設定錯誤報告、日誌和基於日誌的指標，監控多雲環境中的應用程式。適用於 Cloud Run 和 Cloud Functions 等無伺服器運算選項。
- **DevOps 與 CI/CD:**
    - **自動化 CI/CD 管道:** 實施強大的 DevOps 模型和自動化 CI/CD 管道，提高發布速度和可靠性。透過小批量、增量式發布，降低風險、快速除錯、必要時回滾。
    - **持續整合 (CI):** 開發者將程式碼變更合併到共享分支時，觸發自動建置和測試，驗證更新未破壞現有測試。
    - **持續交付 (CD):** CI 驗證的程式碼自動儲存，準備好由運維團隊部署到生產環境。
    - **持續部署 (CD):** 在持續交付基礎上，自動將驗證後的變更部署到生產環境。只有失敗的測試才會阻止部署。
    - **Google Cloud CI/CD 工具:** Cloud Build 偵測程式碼提交、觸發建置和執行單元測試。Artifact Registry 儲存部署產物。Cloud Deploy 自動觸發部署到測試或生產環境。
    - **部署策略:** 生產環境發布時考慮藍綠部署或 Canary 測試，降低新版本問題影響範圍。
- **重構與遷移策略:**
    - **絞殺者模式 (Strangler Pattern):** 在重構或遷移大型應用程式時，使用絞殺者模式。逐步以新組件或服務替換舊應用程式的小組件，透過絞殺者外觀模式 (Strangler Facade) 將請求導向舊應用程式或新服務。隨著新服務發展，逐漸取代舊應用程式。降低風險，從每次服務實作中學習，不影響關鍵業務運作。

---

- **Caching:**
    - **Application Data Caching:** Cache frequently accessed or computationally intensive data to reduce latency and improve performance. Applications should first check the cache and retrieve from backend data sources and update the cache only upon a cache miss or expiration. Memorystore (Redis or Memcached) is GCP's fully managed in-memory caching service.
    - **Content Delivery Network (CDN):** Utilize Cloud CDN to cache web content and serve it closer to users using Google's global edge network, accelerating websites and applications. Cloud CDN can serve static content from Cloud Storage, Cloud Run, or Compute Engine.
- **API Gateway:**
    - **Apigee:** Implement API gateways (like Apigee) as a facade for backend service APIs, providing security, rate limiting, quotas, analytics, and more. For legacy applications that cannot be refactored, API gateways can offer modern API interfaces for consumer applications to interact with.
- **Identity Management:**
    - **Delegated Authentication:** Delegate user authentication to Google or other external providers (like Facebook, GitHub) to simplify user administration. Identity Platform offers a customizable authentication service supporting various methods (external providers, email/password, SAML, OpenID Connect, multi-factor authentication). Firebase Authentication with Identity Platform simplifies user authentication with backend services, SDKs, and UI libraries.
    - **Federated Identity Management:** Employ federated identity management to avoid implementing, securing, and scaling proprietary user authentication solutions.
- **Logging:**
    - **Treat Logs as Event Streams:** View logs as continuous event streams instead of managing log files. Write to event streams like stdout and let the infrastructure collect events for analysis and storage.
    - **Google Cloud Observability:** Leverage Google Cloud Observability to set up error reporting, logging, and logs-based metrics to monitor applications in multi-cloud environments. Suitable for serverless compute options like Cloud Run and Cloud Functions.
- **DevOps & CI/CD:**
    - **Automated CI/CD Pipelines:** Implement a robust DevOps model with automated CI/CD pipelines to increase release velocity and reliability. Incremental and small batch releases reduce risk, enable faster debugging, and facilitate rollbacks.
    - **Continuous Integration (CI):** Automatically trigger builds and tests when developers commit code changes to a shared branch, verifying that updates haven't broken existing tests.
    - **Continuous Delivery (CD):** Automatically store CI-validated code, ready for the operations team to deploy to production.
    - **Continuous Deployment (CD):** Automatically deploy validated changes to production. Only failed tests prevent deployment.
    - **Google Cloud CI/CD Tools:** Cloud Build detects repository commits, triggers builds, and runs unit tests. Artifact Registry stores deployment artifacts. Cloud Deploy automatically triggers deployments to test or production environments.
    - **Deployment Strategies:** Consider blue-green or canary deployments when releasing to production to minimize the impact of new build issues.
- **Refactoring and Migration Strategy:**
    - **Strangler Pattern:** Use the strangler pattern for re-architecting or migrating large applications. Gradually replace smaller components of legacy applications with new components or services. A strangler facade directs requests to old or new services, eventually "strangling" the legacy application. This minimizes risk, allows learning from each service implementation, and avoids impacting business-critical operations.