# 7.4 Vector Search in action

**核心目標：介紹如何在 Google Cloud 上實際使用 Vertex AI Vector Search 服務來建立向量搜尋應用。**

**Vertex AI Vector Search 服務介紹：**

- **定位**：Google Cloud 統合式 AI 開發平台 Vertex AI 中的一項**全代管**服務。
- **優勢**：
    - **緊密整合**：與 BigQuery、嵌入 API、MLOps 等其他 Google Cloud 服務無縫接軌。
    - **高效能**：提供卓越的查詢效能。
    - **高擴展性與可靠度**：達到 Google 等級的企業服務水準，可擴展至數十億向量。
    - **易於建構 Pipeline**：方便快速建立從資料擷取、生成嵌入、建立索引到部署端點的完整機器學習流程。

**建立向量搜尋專案的三種方法：**

1. **無程式碼 (No-Code)**：透過 Google Cloud 控制台 (Console) 的 **Vertex AI 使用者介面 (UI)** 操作。
2. **以程式碼為基礎 (Code-Based)**：使用 **Vertex AI Notebooks**，透過 **API** 呼叫來執行預訓練嵌入和向量搜尋功能。
3. **最少程式碼 (Low-Code)**：使用 **`gcloud` 指令列工具**，功能相對受限，主要用於建立與監控。
    - **課程重點**：將著重於 **UI** 和 **API/Notebooks** 這兩種方法。

**透過 UI 建立索引的步驟概覽：**

1. **進入介面**：Vertex AI > Vector Search > 部署與使用 (Deploy and Use) > 索引 (Index)。
2. **基本設定**：
    - 輸入索引名稱、說明、選擇區域。
    - **定義向量資料來源**：指定儲存在 Google Cloud (例如 Cloud Storage) 上的嵌入向量檔案 (JSON, TFRecord, CSV 等)。
        - **注意**：可以用**任何模型**生成嵌入向量，不限於 Google 的模型，但向量資料**必須儲存在 Google Cloud** 上。
3. **選擇搜尋演算法**：
    - **預設/建議：TreeAh** (基於 ANN，快速、可擴展、適用於正式環境)。
    - 備選：暴力演算法 (線性搜尋，簡單易懂，但效能較差，尤其資料量大時，較常用於開發階段)。
4. **設定參數**：
    - **嵌入維度**：告知 Vector Search 你的向量有多少維度（例如 768）。
    - **近似鄰點數量**：ANN 搜尋時要回傳多少個鄰近點。
    - 擷取方式：批次或串流。
    - 資料分割 (Sharding)：設定索引資料的分割大小（影響處理與價格）。
5. **進階選項**：
    - **距離測量類型**：可選歐氏 (L2)、曼哈頓 (L1)、餘弦、點積。
    - **預設/建議：點積距離 (Dot Product)**。
6. **建立與部署**：
    - 點擊「建立」，索引通常在數分鐘內建立完成（視資料量而定）。
    - 建立後，將索引「部署至端點 (Endpoint)」，端點即可接收查詢請求。

**透過 API/程式碼建立索引的流程範例 (以商品相似度搜尋為例)：**

1. **取得嵌入**：
    - 假設商品資料（如褲子、襪子）存在 **BigQuery** (Google Cloud 的 Data Warehouse)。
    - 在 BigQuery 中使用 `ML.EMBED_TEXT` 函式，直接為商品描述生成文字嵌入向量（例如 768 維）。
2. **儲存嵌入**：將生成的嵌入向量匯出成 **JSON** 檔案，儲存到 **Cloud Storage**。
3. **建立索引 (API)**：呼叫 Vector Search API，指定：
    - 演算法 (如 TreeAh)。
    - Cloud Storage 中 JSON 檔案的路徑。
    - 相關參數（維度、鄰點數、距離類型等）。
    - 索引建立速度很快。
4. **部署端點 (API)**：將建立好的索引部署到端點。
5. **執行查詢**：
    - 將要查詢的商品（例如，也轉成嵌入向量）傳送給端點。
    - 端點會在**毫秒級**的時間內，回傳語意上最相似的商品列表。
    - **強調**：這是**語意搜尋**，理解查詢的「意思」來找相似項，而非關鍵字匹配，使用者體驗更好。

**總結：**

Vertex AI Vector Search 提供方便、高效能且可擴展的方式來建立向量搜尋引擎。使用者可以透過 UI、API 或 gcloud 進行操作。核心流程包含準備好儲存在 Google Cloud 上的嵌入向量、選擇演算法與參數來建立索引，並將索引部署到端點以提供查詢服務。整個過程（尤其是使用 BigQuery ML 等整合工具時）可以相當簡便。