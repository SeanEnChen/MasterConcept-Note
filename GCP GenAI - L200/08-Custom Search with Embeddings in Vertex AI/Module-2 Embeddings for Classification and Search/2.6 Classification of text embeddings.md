# 8.2.6 Classification of text embeddings

**核心用例：利用嵌入技術對項目進行自動分類（例如：產品分類）。**

**情境：** 假設你有一個包含產品名稱和描述的產品目錄，你希望將這些產品自動歸入不同的類別。

**主要步驟：**

1. **生成嵌入 (Generate Embeddings)**：
    - 為**每一個產品描述**計算其對應的嵌入向量。
    - **提醒**：如果產品數量龐大，在呼叫嵌入 API 時，必須記得使用**批次處理 (Batching)** 和**速率限制 (Rate Limiting)** 的技巧（如前述）。
    - **流程簡述**：輸入產品描述列表 -> 進行批次與速率控制 -> 呼叫嵌入 API -> 獲得所有描述的嵌入向量列表。
	
2. **使用 K-Means 進行分群 (Clustering with K-Means)**：
    - **演算法**：採用 **K-Means**，這是一種常用的**非監督式學習**分群演算法。它的目標是將資料點（在這裡是嵌入向量）自動分組成預先定義數量的群組（聚類/類別）。
    - **指定群數 (`k`)**：首先要決定你希望將產品分成**多少個類別**。
        - **舉例**：設定 `k=5`，表示希望分成 5 個類別。
    - **訓練模型**：在計算出的產品描述嵌入向量上，執行 K-Means 算法的 `fit()` 函數。
        - **優點**：由於是在嵌入向量上操作，這個訓練過程通常**非常快速**。
    - **結果**：K-Means 演算法會找到 5 個最佳的「群集中心」，能將語意最相似的產品描述嵌入向量分到同一群。
	
3. **分配項目至群集 (Assigning Items to Clusters)**：
    - **方法**：使用**已經訓練好**的 K-Means 模型的 `predict()` 方法。
    - **操作**：將產品描述的嵌入向量傳遞給 `predict()` 方法。
    - **輸出**：對於每個輸入的嵌入向量，`predict()` 方法會回傳它所屬的**群集索引（Cluster Index）**。
        - **舉例**：如果 `k=5`，則索引會是 0 到 4 之間的一個數字。
	
4. **命名群集 (Mapping Index to Category Name)**：
    - K-Means 只會給出數字索引 (0, 1, 2, ...)，本身沒有意義。
    - 需要**人工介入**，查看每個群集（例如索引為 0 的所有產品、索引為 1 的所有產品...）裡包含了哪些產品，然後根據這些產品的共同特性，為每個數字索引**指派一個有意義的類別名稱**。
    - **舉例**：可能發現索引 0 都是樂器，索引 2 都是軟體，就可以建立一個對應字典 `cluster_map = {0: "樂器", 2: "軟體", ...}`。
	
5. **分類新項目 (Classifying New Items)**：
    - **情境**：現在有新的產品描述，例如「Google Chrome」和「Cymbal Baby Grand Piano」，想知道它們屬於哪個類別。
    - **流程**：
        1. 使用模型的 `get_embeddings()` 方法取得這兩個新描述的嵌入向量。
        2. 將嵌入列表轉換成 K-Means 模型 `predict()` 方法期望的格式（例如，使用 `stack` 和 `squeeze` 轉成 NumPy 陣列）。
        3. 將新的嵌入陣列傳遞給**先前訓練好的 K-Means 模型**的 `predict()` 方法，得到預測的群集索引（例如，得到 `[2, 0]`）。
        4. 使用步驟 4 中建立的 `cluster_map` 字典，將數字索引 `2` 和 `0` 分別對應到實際的類別名稱（例如，「軟體」和「樂器」）。
        5. 輸出人類可讀的分類結果：「軟體」、「樂器」。

**總結：**

這個流程展示了如何結合「嵌入」（用於捕捉產品描述的語意）和「K-Means 分群」（一種自動分組的機器學習方法），來實現基於內容相似性的自動產品分類。先對所有產品描述生成嵌入，然後用 K-Means 將相似的嵌入分群，接著為群組命名，最後就能利用訓練好的 K-Means 模型和名稱對應，來預測新產品應歸屬的類別。